# Pen-Test Style Security Checklist (Phase 6)

> Goal: Provide a reproducible manual / semi-automated checklist for high-risk abuse & integrity scenarios pre-launch.

## 1. Authentication & Session
- [ ] Replay SIWE signature attempt after successful login (expect rejection / nonce rotation)
- [ ] Reuse expired nonce (expect 400/invalid nonce)
- [ ] JWT reuse after refresh rotation (old access token should fail after refresh path triggered)
- [ ] Refresh token reuse attempt (second use must invalidate chain)
- [ ] Force refresh with manipulated scopes (server must ignore client-sent scopes and re-derive)

## 2. Rate Limiting / Abuse
- [ ] Burst > configured token bucket for WebSocket events (expect rate_limited event + no delivery)
- [ ] HTTP POST flood on job creation (429 or enforced backoff)
- [ ] Mixed origin attempts (CORS preflight must block untrusted origins)
- [ ] Distributed pattern simulation (simulate multiple IP/user combos) – ensure per-identity boundaries not global starvation

## 3. CSRF / State Changing Operations
- [ ] Omit CSRF header on POST (expect 403)
- [ ] Send mismatched CSRF cookie/header pair (expect 403)
- [ ] POST from cross-site origin with cookies (should be blocked by SameSite+lax policy or origin check)

## 4. Input Sanitization & Content Safety
- [ ] Inject <script> tags in job description (stripped or encoded)
- [ ] Event handler attributes (onerror=alert(1)) removed
- [ ] Iframe / object / embed tags removed
- [ ] Markdown edge: autolinks and images sanitized (if markdown allowed) – current policy: plain text only
- [ ] Oversized payload (> expected limits) truncated or rejected

## 5. Escrow & On-Chain Interaction
- [ ] Double-spend attempt (re-submit milestone payment tx) – contract revert duplicate payment
- [ ] Dispute path unauthorized caller (non-owner) – revert
- [ ] Emergency withdrawal before timeout – revert
- [ ] Platform fee >10% injection attempt – revert

## 6. Reputation / Reviews
- [ ] Duplicate review submission (same reviewer → reviewee) – blocked
- [ ] Oversized comment (>500 chars) – revert
- [ ] Review self – revert
- [ ] Verify review twice – revert on second

## 7. Notification / Realtime Channel
- [ ] Emit malformed notification payload (server rejects / sanitizes)
- [ ] High-frequency ACK spam – should not degrade server (rate limit counters observe)
- [ ] Fake room join for another user – denied
- [ ] Drop client ACKs (retry backoff engages, giveup counter increments)

## 8. Cache / Consistency
- [ ] Stale jobs list after create (version bump invalidates; expect fresh data)
- [ ] Conditional GET with outdated ETag returns 200 with new ETag
- [ ] Replay 304 logic with mismatched ETag (server should ignore and return 200)

## 9. Secrets & Config
- [ ] Missing critical env (e.g., DATABASE_URL) – health endpoint flags
- [ ] Secrets rotated (old JWT signing key invalidates old refresh chain) – confirm logout on reuse

## 10. Logging / PII Minimization
- [ ] No secrets (tokens, refresh values) logged in application logs
- [ ] Correlation IDs present for all API 5xx responses
- [ ] Error stack traces suppressed in production mode (generic error surface)

## 11. Denial of Service Vectors
- [ ] Large JSON body (>=1MB) – request rejected early
- [ ] Pathological filter combinations (skills array large) – bounded or rejected
- [ ] WebSocket connection churn (rapid connect/disconnect) increments counters – potential quarantine action (future)

## 12. Deployment / Infrastructure
- [ ] Strong TLS (HSTS header present – already configured)
- [ ] No `X-Powered-By` leakage
- [ ] Security headers present (CSP NOTE: pending if adopted; currently not set)

## Tooling Aids
| Vector | Tooling | Status |
| ------ | ------- | ------ |
| Replay & nonce | Custom script + stored signature | Pending |
| Rate limit flood | k6 / autocannon scenario | Partial |
| Input sanitizer | Jest unit tests for sanitizer helper | Pending |
| Escrow invariants | Hardhat pseudo-fuzz test | Added |
| Reputation invariants | Hardhat pseudo-fuzz test | Added |

## Follow-Up Automation Candidates
- CI step: sanitizer regression tests
- k6 scenario for WebSocket message flood
- Playwright script for CSRF negative cases

## Risk Rating Legend
- HIGH: Compromise of funds, auth bypass
- MEDIUM: Data integrity / spoofing
- LOW: UX degradation / minor leakage

Document Owner: Security Champion (assign before launch)
Last Updated: (populate on each review)
